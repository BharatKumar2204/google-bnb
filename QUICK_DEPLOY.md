# Quick Deploy to Google Cloud Run

Deploy your AI News App to Google Cloud Run in 5 minutes!

## Prerequisites

- Google Cloud account with billing enabled
- GitHub repository
- gcloud CLI installed

## Step 1: Run Setup Script

### Windows
```cmd
cd ai-news-app
setup-gcp-deployment.bat
```

### Linux/Mac
```bash
cd ai-news-app
chmod +x setup-gcp-deployment.sh
./setup-gcp-deployment.sh
```

This script will:
- Enable required Google Cloud APIs
- Create Artifact Registry
- Create service account with proper permissions
- Generate `github-actions-key.json`

## Step 2: Configure GitHub Secrets

Go to your GitHub repo: **Settings â†’ Secrets and variables â†’ Actions**

Add these secrets:

| Secret Name | Value | Where to Get |
|------------|-------|--------------|
| `GCP_SA_KEY` | Content of `github-actions-key.json` | Generated by setup script |
| `GCP_PROJECT_ID` | Your GCP project ID | From setup script output |
| `GEMINI_API_KEY` | Your Gemini API key | https://makersuite.google.com/app/apikey |
| `BACKEND_URL` | Backend URL | Leave empty for now, add after backend deploys |

## Step 3: Deploy Backend

### Option A: Via GitHub Actions (Recommended)

1. Commit and push your code:
```bash
git add .
git commit -m "Add deployment configuration"
git push origin main
```

2. Go to GitHub: **Actions â†’ Deploy Backend to Cloud Run â†’ Run workflow**

3. Wait for deployment to complete

4. Get backend URL from workflow output or run:
```bash
gcloud run services describe ai-news-backend --region us-central1 --format 'value(status.url)'
```

### Option B: Manual Deployment

```bash
cd mcp_server

# Build and deploy
gcloud run deploy ai-news-backend \
  --source . \
  --platform managed \
  --region us-central1 \
  --allow-unauthenticated \
  --set-env-vars "GEMINI_API_KEY=your-key,GCP_PROJECT_ID=your-project,MCP_SERVER_HOST=0.0.0.0,MCP_SERVER_PORT=8080" \
  --memory 2Gi
```

## Step 4: Update BACKEND_URL Secret

1. Copy the backend URL from Step 3
2. Go to GitHub: **Settings â†’ Secrets â†’ BACKEND_URL**
3. Add the URL (e.g., `https://ai-news-backend-xxxxx-uc.a.run.app`)

## Step 5: Deploy Frontend

### Via GitHub Actions

1. Go to GitHub: **Actions â†’ Deploy Frontend to Cloud Run â†’ Run workflow**
2. Wait for deployment
3. Get frontend URL from workflow output

### Manual Deployment

```bash
cd frontend

gcloud run deploy ai-news-frontend \
  --source . \
  --platform managed \
  --region us-central1 \
  --allow-unauthenticated \
  --set-env-vars "VITE_API_URL=https://your-backend-url" \
  --memory 512Mi
```

## Step 6: Test Your Deployment

### Backend Health Check
```bash
curl https://ai-news-backend-xxxxx-uc.a.run.app/health
```

### Frontend
Open in browser:
```
https://ai-news-frontend-xxxxx-uc.a.run.app
```

## Automatic Deployments

After initial setup, deployments are automatic:

- **Backend**: Push changes to `mcp_server/**` â†’ Auto-deploys
- **Frontend**: Push changes to `frontend/**` â†’ Auto-deploys

## Troubleshooting

### "Permission denied" errors
- Verify service account has correct roles
- Re-run setup script

### "API not enabled" errors
```bash
gcloud services enable run.googleapis.com
gcloud services enable artifactregistry.googleapis.com
```

### Backend returns 500 errors
- Check logs: `gcloud run services logs read ai-news-backend --region us-central1`
- Verify GEMINI_API_KEY is set correctly

### Frontend can't connect to backend
- Verify BACKEND_URL secret is correct
- Check CORS settings in backend
- Ensure backend is deployed and healthy

## Cost Estimate

With Cloud Run's free tier:
- **First 2 million requests/month**: FREE
- **After that**: ~$0.40 per million requests
- **Idle time**: $0 (pay only when serving requests)

Typical monthly cost for low-medium traffic: **$0-5**

## What's Deployed?

### Backend Service
- **Name**: `ai-news-backend`
- **Region**: `us-central1`
- **Memory**: 2Gi
- **CPU**: 2
- **Port**: 8080
- **Scaling**: 0-10 instances

### Frontend Service
- **Name**: `ai-news-frontend`
- **Region**: `us-central1`
- **Memory**: 512Mi
- **CPU**: 1
- **Port**: 8080
- **Scaling**: 0-5 instances

## Next Steps

1. âœ… Set up custom domain (optional)
2. âœ… Configure monitoring alerts
3. âœ… Set up Cloud CDN for better performance
4. âœ… Enable Cloud Armor for DDoS protection
5. âœ… Set up backup strategy

## Support

Need help? Check:
1. [Full Deployment Guide](DEPLOYMENT_GUIDE.md)
2. GitHub Actions logs
3. Cloud Run logs: `gcloud run services logs read SERVICE_NAME`

---

**That's it! Your app is now live on Google Cloud Run! ðŸš€**
